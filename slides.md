# 1. Титульный
 
Представиться. 

# 2. Поставленные задачи  
  
Задачей данной работы является применение средств выразительности, которые предоставляют современные разработки в области функционального программирования, к разработке библиотек парсеров и прикладных программ для трансляции языков разметри. 

# 3. Использованные результаты

Мной были использованы результаты трёх работ:

Первая из представленных на слайде работ описывает основы монадического
подхода к построению парсеров. 

Во второй работе описан подход к моноидальному представлению строковых типов в языке Haskell.

В третьей работе представлен альтернативный трансформерам монад механизм комбинирования вычислительных эффектов. 

# 4. Библиотеки монадических парсеров

Parsec является библиотекой промышленного уровня, используется 
во многих проектах, например в универсальном конвертере документов Pandoc. Преимуществами Parsec являются его гибкость и подробность сообщений об ошибках.

Другой популярной библиотекой является attoparsec. При
разработке attoparsec акцент был сделан на скорость, поэтому бы-
ло принято решение пожертвовать информативностью сообщений об ошибках. Основным
предназначением attoparsec является анализ сетевого трафика.

Picoparsec является форком attoparsec, в котором применяется моноидальноидальное представление исходного текста. 

# 5. Исходный тип для парсера.

На слайде приведён базовый тип для парсера и экземпляр класса типов Monad. Монады в функциональном программировании -- это в паттерн проектирования, используемый для описания вычислений с побочными эффектами. В случае парсера эффектом является хранение состояния и возможность неудачного разбора.

# 6. Строковые типы языка Haskell

String -- является псевдонимом для списком символов, а значит требует
высоких расходов памяти и имеет низкую скорость работы.  
 
ByteString -- предназначен для работы с сырой бинарной информацией, 
работает быстрее String.

Text -- обладает достоинствами ByteString, но специализирован для работы с
текстом.

# 7. Строковые типы как моноиды

Авторы библиотек монадических парсеров либо реализуют поддержку только одного типа, либо вынуждены дублировать код для разных типов. Для борьбы с такими проблемами в языке Haskell принято выносить одинаковые операции в интерфейс класса типов. В 2013 году на Haskell Symposium были представлены теоретические и практические результаты разработки библиотеки для абстрактной работы со строковыми (и не только) типами в Haskell. Класс типов TextualMonoid, предоставляемый этой библиотекой, был использован при реализации парсера.

# 8. Парсер как стек монад
 
Монаду Parser можно представить в виде комбинации двух более простых монад: State и монады для потенциально ошибочных вычислений. Для построения более развитых парсеров можно добавить к стеку другие эффекты: журналирование вычислений, конфигурационную информацию и другие.  

На слайде представлен тип для парсера из реализуемой библиотеки. Стек состоит из монад, которые обеспечивают вычисления с состоянием и возможность ошибки.

# 9. Расширяемые Эффекты

Подход с трансформерами монад имеет недостатки: проблемы с выводом типов при наличии двух одинаковых эффектов в стеке, возможность падения производительности при большом стеке. Новый подход был предложен в статье Extensible Effects: An Alternative to Monad Transformers, была выпущена соответствующая библиотека. 

Тип Eff представляет собой свободную монаду, полученную из функтора Union r. 
Union -- это особый тип, представляющий неупорядоченный набор эффектов.

В рамкой этой работы я разрабатывал библиотеку монадических парсеров, основанную на подходе с эффектами.

# 10. Парсер, основанный на Extensible Effects

При работы с расширяемыми эффектами не требуется явно описывать тип для
парсера, каждая функция-парсер содержит в своём типе нужные эффекты.

На слайде представлен парсер, распознающий символ, который удовлетворяет
данному предикату и его набор эффектов: Fail для возможности неудачного разбора и State String для хранения состояния разбираемой строки.

# 11. Ещё парсер, основанный на Extensible Effects

На слайде представлен парсер для распознавания слов, его тип содержит 
дополнительный эффект Choose, позволяющий использоваться операции, 
аналогичные тем, что предоставляют классы типов MonadPlus и Alternative. 

Функция для запуска парсера также содержит дополнительную операцию, отвечающую
за обработку эффекта Choose.

# 12. Язык Markdown и его использование
  
Язык Markdown -- легковесный язык разметки, применяется для быстрой вёрстки небольших документов. Полезен в случаях, когда нет необходимости привлекать такие тяжеловесные форматы как HTML и LaTeX. Популярен в интернете, к примеру, на известном хостинге программного кода GitHub. Используется в движке Discourse, на котором работает форум Мехмата.

# 13. Пример документа Markdown

Слева на слайде представлен пример исходного текста на языке Markdown, а справа -- сгенерированный программой HTML, открытый на просмотр в браузере. 

# 14. AST для Markdown в Haskell
  
Результатом роботы парсера является абстрактное синтаксическое дерево: документ состоит из блоков нескольких типов, в листьях находятся инлайн-элементы. На слайде представлены алгебраические типы данных языка Haskell, описывающее абстрактное синтаксическое дерево Markdown-документа.

# 15. AST для Markdown в Haskell, продолжение

# 16. Конструирование AST

Конструирование AST производится вызовом парсера doc, с передачей ему в качестве параметра строки с Markdown-документом. Описание парсера doc отражает структуру AST: документ является списком блоков.

Для каждого типа узлов абстрактного синтаксического дерева описывается парсер. В качестве примера на слайде представлена парсер для Markdown-заголовка. Открывает заголовок непустая последовательность символов "решётка", их число отражает размер заголовка. После решёток следует строка текста. 

# 17. Результаты

Произведена основная работа по разработке первой библиотеки парсеров, основанной на трансформерах монад. 

Разработан транслятор подмножества Markdown со вставками \LaTeX в HTML.

Начата разработка второй библиотеки, основанной на применении результатов статьи Extensible Effects к построению монадических парсеров.